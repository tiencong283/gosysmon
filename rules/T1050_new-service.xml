<Sysmon schemaversion="4.30">
    <!--
        References:
            https://attack.mitre.org/techniques/T1050/
        List:
        Todo:

        Testing:
            https://github.com/redcanaryco/atomic-red-team/blob/T1003-Pwcollector/atomics/T1050/T1050.md
    -->

    <EventFiltering>
        <RuleGroup name="" groupRelation="or">
            <ProcessCreate onmatch="include">
                <Rule name="technique_id=T1050" groupRelation="or">
                    <CommandLine condition="contains">sc.exe create</CommandLine>
                    <CommandLine condition="contains">sc create</CommandLine>
                    <CommandLine condition="contains">"C:\Windows\system32\sc.exe" create</CommandLine>
                    <CommandLine condition="contains">sc.exe config</CommandLine>
                    <CommandLine condition="contains">sc config</CommandLine>
                    <CommandLine condition="contains">"C:\Windows\system32\sc.exe" config</CommandLine>
                    <OriginalFileName condition="is">psservice.exe</OriginalFileName>
                    <OriginalFileName condition="is">psservice64.exe</OriginalFileName>
                </Rule>
            </ProcessCreate> 
   
            <RegistryEvent onmatch="include">
                <Rule name="technique_id=T1050" groupRelation="or">
                    <TargetObject condition="begin with">HKU\SOFTWARE\Sysinternals\PsService</TargetObject>
                    <TargetObject condition="begin with">HKU\SOFTWARE\Sysinternals\PsService64</TargetObject>
                    <!-- <TargetObject condition="begin with">HKLM\SYSTEM\CurrentControlSet\Services</TargetObject> -->
                </Rule>
            </RegistryEvent>
        </RuleGroup>
    </EventFiltering>
</Sysmon>