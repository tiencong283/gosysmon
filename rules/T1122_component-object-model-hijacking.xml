<Sysmon schemaversion="4.30">
    <!--
        References:
            https://attack.mitre.org/versions/v6/techniques/T1122/
            https://docs.microsoft.com/en-us/windows/win32/com/clsid-key-hklm#:~:text=The%20HKEY_LOCAL_MACHINE%5CSOFTWARE%5CClasses%20key,is%20in%20the%20running%20state.
            https://docs.microsoft.com/en-us/dotnet/framework/unmanaged-api/profiling/setting-up-a-profiling-environment
        List:
        Todo:
        Testing:
            https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.015/T1546.015.md
    -->
    <EventFiltering>
        <RuleGroup groupRelation="or">
            <RegistryEvent onmatch="include">
                <Rule name="technique_id=T1122" groupRelation="or">
                    <TargetObject condition="contains">Classes\CLSID\</TargetObject>
                    <TargetObject condition="end with">\Environment\COR_ENABLE_PROFILING</TargetObject>
                    <TargetObject condition="end with">\Environment\COR_PROFILER</TargetObject>
                    <TargetObject condition="end with">\Environment\COR_PROFILER_PATH</TargetObject>
                </Rule>
            </RegistryEvent>
        </RuleGroup>
    </EventFiltering>
</Sysmon>